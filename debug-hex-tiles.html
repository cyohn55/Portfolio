<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Hex Tiles</title>
    <style>
        body { 
            font-family: monospace; 
            background: #222; 
            color: #0f0; 
            padding: 20px; 
        }
        #gameScreen {
            width: 800px;
            height: 600px;
            position: relative;
            background: #333;
            border: 2px solid #555;
            margin: 20px 0;
        }
        #hexGridContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,255,0,0.1);
        }
        #hex-grid {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 100%;
            height: 100%;
        }
        .hex-tile {
            border: 1px solid #0f0;
            background: rgba(255,255,255,0.1);
        }
        .tile-3d-container {
            border: 2px solid #f0f;
            background: rgba(255,0,255,0.1);
        }
        #debug-output { 
            max-height: 400px; 
            overflow-y: auto; 
            background: #111; 
            padding: 10px; 
            border: 1px solid #333; 
        }
    </style>
</head>
<body>
    <h1>🐛 Debug Hex Tiles Rendering</h1>
    <button onclick="testHexGeneration()">🔧 Generate Hex Grid</button>
    <button onclick="debugTerrainSystem()">🔍 Debug Terrain System</button>
    <button onclick="clearDebug()">🧹 Clear Output</button>
    
    <div id="gameScreen">
        <div id="hexGridContainer">
            <div id="hex-grid"></div>
        </div>
    </div>
    
    <div id="debug-output"></div>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <script src="js/hex-coordinate.js"></script>
    <script src="js/game-config.js"></script>
    <script src="js/terrain-system.js"></script>

    <script>
        const debugOutput = document.getElementById('debug-output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#ff0';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugOutput.appendChild(div);
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }

        function clearDebug() {
            debugOutput.innerHTML = '';
        }

        function testHexGeneration() {
            log('🔧 Testing hex grid generation...', 'info');
            
            try {
                // Check if container exists
                const container = document.getElementById('hex-grid');
                log(`📦 Container found: ${container ? 'YES' : 'NO'}`, container ? 'success' : 'error');
                
                if (!container) {
                    log('❌ No container found - stopping test', 'error');
                    return;
                }
                
                // Clear existing content
                container.innerHTML = '';
                log('🧹 Cleared existing tiles', 'info');
                
                // Create terrain system
                const terrainSystem = new TerrainSystem();
                log('✅ Terrain system created', 'success');
                
                // Test generateHexGrid method
                log('🎯 Calling generateHexGrid(4, 4)...', 'info');
                const result = terrainSystem.generateHexGrid(4, 4, true);
                
                log(`📊 Generation result: ${result}`, result ? 'success' : 'error');
                log(`📈 Container children count: ${container.children.length}`, 'info');
                
                // List all children
                for (let i = 0; i < container.children.length; i++) {
                    const child = container.children[i];
                    log(`  [${i}] ${child.className} at (${child.style.left}, ${child.style.top})`, 'info');
                    
                    // Check if model-viewer exists
                    const modelViewer = child.querySelector('model-viewer');
                    if (modelViewer) {
                        log(`    📦 Model: ${modelViewer.getAttribute('src')}`, 'info');
                    } else {
                        log(`    ❌ No model-viewer found`, 'error');
                    }
                }
                
            } catch (error) {
                log(`💥 Error during generation: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        function debugTerrainSystem() {
            log('🔍 Debugging terrain system...', 'info');
            
            try {
                // Check if classes are available
                log(`HexCoord available: ${typeof HexCoord !== 'undefined'}`, 'info');
                log(`TerrainSystem available: ${typeof TerrainSystem !== 'undefined'}`, 'info');
                log(`TERRAIN_CONFIG available: ${typeof window.TERRAIN_CONFIG !== 'undefined'}`, 'info');
                
                if (typeof window.TERRAIN_CONFIG !== 'undefined') {
                    const terrainTypes = Object.keys(window.TERRAIN_CONFIG.types || {});
                    log(`Terrain types: ${terrainTypes.join(', ')}`, 'info');
                }
                
                // Test hex coordinate creation
                if (typeof HexCoord !== 'undefined') {
                    const coord = new HexCoord(0, 0);
                    log(`✅ HexCoord test: (0,0) created successfully`, 'success');
                    
                    const neighbors = coord.getNeighbors();
                    log(`🔄 Neighbors count: ${neighbors.length}`, 'info');
                }
                
            } catch (error) {
                log(`💥 Debug error: ${error.message}`, 'error');
            }
        }

        // Auto-run basic debug on load
        document.addEventListener('DOMContentLoaded', () => {
            log('🚀 Debug page loaded', 'success');
            setTimeout(debugTerrainSystem, 100);
        });
    </script>
</body>
</html>
